0.6 is out!
###########

:date: 2024-12-02 00:00:00
:status: hidden
:category: Release
:summary: Cubos 0.6 Release!

.. role:: dim
    :class: m-text m-dim

New 0.6 Features
================

This blog post covers the most important changes, but you can check out the full changelog in our `repository <https://github.com/GameDevTecnico/cubos/blob/main/CHANGELOG.md>`_.

On the Editor
-------------

Editor Feature 1 :dim:`(@Author1)`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

TODO: explain feature and why it is useful

On the Engine
-------------

Engine Feature 1 :dim:`(@Author2)`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

TODO: explain feature and why it is useful

Sub-title for this feature
**************************

Physics with Warm-Starting :dim:`(@fallenatlas)`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Continuing the work from the previous release, we finished **warm-starting** for our physics simulation. Warm-starting takes the information stored in the contact manifold between the two contacting bodies, particularly, the total impulses applied on each point on the previous frame, and applies it before any solving is performed.
It works based on the assumption that the impulses applied on the previous frame are a good estimate for the impulses that will also be applied in the current frame. Therefore, by applying them to the body before solving the collision constraint, the body should be already nearer it's ideal position. Over time, these impulses will stablize (since our solver is a "dirty" solver), leading to less jitter.
This works especially well for stacks of bodies, since in this case bodies will be pushing each other away, creating instability. However, if they're already closer to their ideal position, this instability will be reduced. With warm-starting we can both stack more bodies, and when the stack isn't fully stable it stays together for longer.

Here you can see how, in our complex physics sample, the stack holds for much longer than before, although it still falls in the end.

.. image:: images/complex_physics_sample_warm_starting.gif

However, if we increase our physics update rate to 60 times per second (rather than our current 30), and the substeps performed in each update to 8 (instead of our current 4), we can see that a stack of 8 blocks holds mostly stable.

.. image:: images/complex_physics_sample_1_stack.gif

Unfortunatly, our collisions are not optimized to the point where we can have 60 updates per second with many bodies, but the door is open for this upgrade in the future!

Toggleable SSAO and resolution scale :dim:`(@tomas7770)`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Some time ago, we profiled Cubos's graphics engine to determine the main performance bottlenecks. SSAO stood out as the
graphics plugin that took the most frametime. However, due to the way the rendering pipeline was implemented, disabling it to get
better performance wasn't possible without breaking rendering altogether.
Starting with this release, the `SSAO <https://docs.cubosengine.org/structcubos_1_1engine_1_1SSAO.html>`_ component can be removed
from a render target to disable this feature.

In addition, we found that other game engines often default to rendering SSAO textures at half the width/height of the screen resolution,
which greatly improves performance without major loss in quality.
To implement this, we added a `resolution scale <https://docs.cubosengine.org/structcubos_1_1engine_1_1SSAO.html#ab4c8760eb1582559172373476ff04508>`_ option to the SSAO component,
which defaults to 0.5, but can be set to any value up to 2.0.

Conditional shader compilation :dim:`(@tomas7770)`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Another major bottleneck in the graphics renderer is the `render picker <https://docs.cubosengine.org/structcubos_1_1engine_1_1RenderPicker.html>`_, which
allows finding out which entity is visible at a given pixel. As explained in the **Modular Renderer** section of the `0.2 blog post <https://cubosengine.org/coffeen-jam-and-02.html>`_,
we attempted to mitigate performance loss with Pixel Buffers and double-buffering. But despite this, it remains a demanding feature.

Just like what happened with SSAO, disabling the render picker wasn't possible. Unlike the former, though, this one required the ability
to change shaders' source code at runtime. To solve this, we added new methods to the `Shader <https://docs.cubosengine.org/classcubos_1_1engine_1_1Shader.html>`_
class to prepend ``#define`` macros and recompile the shader.

.. code-block:: cpp

    auto vs = vsAsset->shaderStage(); // unmodified shader
    vs = vsAsset->builder().with("RENDER_PICKER").build(); // shader with #define RENDER_PICKER
    vs = vsAsset->builder().with("MAX_CSM_SPLITS", "5").build(); // shader with #define MAX_CSM_SPLITS 5

Unfortunately, the actual ability to toggle render picking didn't make it to this release, but it should make it to the next one!

On the Core
-----------

Added Frustum geometry and intersection utilities :dim:`(@mkuritsu)`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A new geometry object was added, the **Frustum**, and with that it was also added two new intersection functions to check if a `Box <https://docs.cubosengine.org/structcubos_1_1core_1_1geom_1_1Box.html>` or a `Capsule <https://docs.cubosengine.org/structcubos_1_1core_1_1geom_1_1Capsule.html>` is inside the Frustum.
This new geometry and functions will prove useful to perform Frustum culling in a future release that could bring a great performance improvement to the graphics rendering in Cubos.

Core Feature 1 :dim:`(@Author3)`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

TODO: explain feature and why it is useful

Next Steps
==========

In the next release, which should be out by **TODO WHEN**, we're planning to work on the following features:

* Very cool feature 1.
* Very cool feature 2.
* ...

TODO: maybe some more stuff here if needed

You can check out the full list of stuff we want to get done in the `milestone <https://github.com/GameDevTecnico/cubos/milestone/29>`_ for the next release.
